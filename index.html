<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire 5D-ASC ‚Äì Version Fran√ßaise</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@700,500,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', Helvetica, Helvetica, Helvetica, Helvetica;
            line-height: 1.6;
            color: #3b434c;
            background: linear-gradient(0deg, #f5f5f5 0%, #ffffff 100%);
            
            min-height: 100vh;
        }
        .satoshi-title {
    font-family: 'Satoshi', sans-serif;
}
.container {
    max-width: 800px;
    margin: 4rem auto;
    background: white;
    min-height: auto;
    padding: 2rem; /* padding int√©rieur sur tous les c√¥t√©s */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border-radius: 75px;
}

/* Ajustement sp√©cifique pour les petits √©crans */
@media (max-width: 768px) {
    .container {
        margin: 2rem 1rem; /* 2rem en haut/bas, 1rem √† gauche/droite */
        padding: 1.5rem;
    }
}

.header {
    position: relative;
    z-index: 1;
    color: white;
    padding: 1rem;
    text-align: center;
    border-radius: 50px;
    overflow: hidden;
    border: 0.5px solid #ffffff;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    background: none;
}

.header::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: 0;
    border-radius: 50px;
    filter: blur(20px);
    background: radial-gradient(circle at 20% 30%, #ffdfa2 0%, transparent 30%),
                radial-gradient(circle at 40% 40%, #d8aec9 0%, transparent 30%),
                radial-gradient(circle at 50% 50%, #b5c8e1 10%, transparent 30%),
                radial-gradient(circle at 60% 20%, #c1e6cc 0%, transparent 30%),
                radial-gradient(circle at 30% 80%, #eaba96 0%, transparent 30%),
                radial-gradient(circle at 50% 80%, #eed4bf 0%, transparent 30%),
                radial-gradient(circle at 90% 90%, #ffdfa2 0%, transparent 30%),
                radial-gradient(circle at 90% 40%, #d8aec9 0%, transparent 30%),
                radial-gradient(circle at 0% 40%, #d8aec9 10%, transparent 30%),
                radial-gradient(circle at 70% 70%, #b5c8e1 20%, transparent 30%),
                radial-gradient(circle at 60% 20%, #c1e6cc 0%, transparent 30%),
                radial-gradient(circle at 10% 90%, #c1e6cc 10%, transparent 30%),
                radial-gradient(circle at 10% 10%, #eaba96 0%, transparent 30%);
    animation: blobWiggle 13s ease-in-out infinite;
    background-size: 170% 170%;
}

.header h1,
.header p {
    position: relative;
    z-index: 1;
}

@keyframes blobWiggle {
    0% {
        background-position: 0% 0%;
    }
    25% {
        background-position: 50% 50%;
    }
    50% {
        background-position: 100% 0%;
    }
    75% {
        background-position: 50% 100%;
    }
    100% {
        background-position: 0% 0%;
    }
}

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 2rem;
        }

        .version-selector {
            background: #f8f9fa;
            border-radius: 50px;
            padding: 2rem;
            margin-bottom: -1rem;
            text-align: center;
        }

        .version-selector h2 {
            margin-bottom: 1.5rem;
            color: #2c3e50;
        }

        .version-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .version-btn {
            background: white;
            border: 2px solid #3a4651;
            color: #3a4651;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .version-btn:hover,
.version-btn.active {
    position: relative;
    color: white;
    border: 2px solid white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    overflow: hidden;
    z-index: 1;
}

.version-btn:hover::before,
.version-btn.active::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: -1;
    border-radius: inherit;
    filter: blur(12px);
    background: radial-gradient(circle at 20% 30%, #ffdfa2 0%, transparent 30%),
                radial-gradient(circle at 40% 40%, #d8aec9 0%, transparent 30%),
                radial-gradient(circle at 50% 50%, #b5c8e1 10%, transparent 30%),
                radial-gradient(circle at 60% 20%, #c1e6cc 0%, transparent 30%),
                radial-gradient(circle at 30% 80%, #eaba96 0%, transparent 30%),
                radial-gradient(circle at 50% 80%, #eed4bf 0%, transparent 30%),
                radial-gradient(circle at 90% 90%, #ffdfa2 0%, transparent 30%),
                radial-gradient(circle at 90% 40%, #d8aec9 0%, transparent 30%),
                radial-gradient(circle at 0% 40%, #d8aec9 10%, transparent 30%),
                radial-gradient(circle at 70% 70%, #b5c8e1 20%, transparent 30%),
                radial-gradient(circle at 60% 20%, #c1e6cc 0%, transparent 30%),
                radial-gradient(circle at 10% 90%, #c1e6cc 10%, transparent 30%),
                radial-gradient(circle at 10% 10%, #eaba96 0%, transparent 30%);
    background-size: 200% 200%;
    animation: blobWiggle 12s ease-in-out infinite;
}

.version-btn:hover span,
.version-btn.active span {
    position: relative;
    z-index: 1;
}

@keyframes blobWiggle {
    0%   { background-position: 0% 0%; }
    25%  { background-position: 50% 50%; }
    50%  { background-position: 100% 0%; }
    75%  { background-position: 50% 100%; }
    100% { background-position: 0% 0%; }
}

@media (max-width: 768px) {
    .version-btn:hover, .version-btn.active {
        background-size: cover;
    }
}

.pdf-btn {
    background: white;
    border: 2px solid #dc3545;
    color: #dc3545;
    padding: 1rem 2rem;
    border-radius: 50px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
    min-width: 280px;
    margin-top: 1.5rem;
    display: inline-block;
    text-decoration: none;
}

.pdf-btn:hover {
    position: relative;
    color: white;
    border: 2px solid white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    overflow: hidden;
    z-index: 1;
}

.pdf-btn:hover::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: -1;
    border-radius: inherit;
    filter: blur(12px);
    background: radial-gradient(circle at 20% 30%, #ffb3ba 0%, transparent 30%),
                radial-gradient(circle at 60% 20%, #ff9999 0%, transparent 30%),
                radial-gradient(circle at 40% 40%, #ff6b6b 0%, transparent 30%),
                radial-gradient(circle at 80% 80%, #e74c3c 0%, transparent 30%),
                radial-gradient(circle at 10% 90%, #dc3545 10%, transparent 30%);
    background-size: 200% 200%;
    animation: blobWiggle 12s ease-in-out infinite;
}

.pdf-btn:hover span {
    position: relative;
    z-index: 1;
}



        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 50px;
            margin-top: 1rem;
            margin-bottom: 2rem;
            border: 0.5px solid #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #7c90e8, #7b589e);
            height: 100%;
            border-radius: 50px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .item-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #e4e6e8;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .item-question {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #44484d;
            line-height: 1.5;
        }

        .vas-container {
            position: relative;
            margin-top: 1rem ;
        }

        .vas-slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: #e9ecef;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    position: relative;
}

.vas-slider::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, #7c90e8, #7b589e);
    width: var(--slider-progress, 0%);
    transition: width 0.2s ease;
    z-index: 0;
}
.vas-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: linear-gradient(90deg, #7c90e8, #7b589e);
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
}

        .vas-slider::-webkit-slider-thumb:hover {
            transform: scale(1.5);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .vas-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .vas-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 0.5rem;
}
.vas-label.right {
    text-align: right;
}
.vas-value {
    font-weight: bold;
    font-size: 1.1rem;
    text-align: center;
    width: 50px;
    height: 50px;
    line-height: 50px;
    border-radius: 50%;
    border: 1px solid #dee2e6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    margin: 0 auto;
    color: #dee2e6;         
    background-color: white;
    transition: all 0.3s ease;
}

.vas-value.active {
    background-color: #abdbb9; 
    color: white;
    border-color: #90c49c;
}
.vas-value.saved {
    background: #abdbb9;
    color: #ffffff;
    border-color: #90c49c;
}
.vas-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
}

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e9ecef;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        @font-face {
    font-family: 'Euclid Circular B Bold';
    src: url('Euclid Circular B Bold.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'Euclid Circular B Medium';
    src: url('Euclid Circular B Medium.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}




@font-face {
    font-family: 'Organo';
    src: url('Organo.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}


        .nav-btn:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .nav-btn.secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .nav-btn.secondary:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .completion-section {
            text-align: center;
            padding: 3rem 2rem;
        }

        .completion-section h2 {
            color: #6eb798;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .completion-section p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: #6c757d;
        }

        .download-btn {
            background: linear-gradient(135deg, #acc8b9, #28ab74);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #687b71, #1b724e);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.3);
        }

        .required-indicator {
            color: #dc3545;
            margin-left: 4px;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: none;
        }
        @font-face {
    font-family: 'Satoshi';
    src: url('fonts/Satoshi-Black.ttf') format('truetype');
    font-weight: 900;
    font-style: normal;
}
        @media (max-width: 768px) {
            .container {
                margin: 0;
                box-shadow: none;
            }
            
            .header {
                padding: 1.5rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .version-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .version-btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>


    
    <div class="container">
        <div class="header">
            <h1 style="margin-bottom: 0.5rem;">
                <!-- Premier √©l√©ment : "Questionnaire" avec cadre circulaire blanc -->
                <div style="
                    display: inline-block;
                    background: rgba(255, 255, 255, 0.339);
                    border: 4px solid white;
                    border-radius: 50px;
                    padding: 0.5rem 2rem;
                    margin-top: 0.5rem;
                    margin-bottom: 0.5rem;
                    backdrop-filter: blur(10px);">
                    <span style="
                        color: white;
                        font-size: 2rem;
                        font-weight: 900;
                        font-family: 'Satoshi', sans-serif;">
                        Questionnaire
                    </span>
                </div>
                
                <!-- Deuxi√®me √©l√©ment : "5D-ASC" en gris fonc√© sans fond -->
                <div style="margin-top: 0.3rem; margin-bottom: -1rem;">
                    <span style="
                        color: #343a40;
                        font-size: 2.8rem;
                        font-weight: 900;
                        
                        font-family: 'Euclid Circular B Bold', sans-serif;
                        text-shadow: 1px 1px 3px rgba(255,255,255,0.8);">
                        5D - ASC
                    </span>
                </div>
            
                <!-- Trois petits cercles d√©coratifs -->
                <!-- <div style="
                    display: flex;
                    justify-content: center;
                    gap: 1rem;
                    margin: 0.8rem 0 0rem 0;">
                    <span style="
                        width: 10px;
                        height: 10px;
                        background: white;
                        border: 1px solid #dee2e6;
                        border-radius: 50%;
                        display: inline-block;"></span>
                    <span style="
                        width: 10px;
                        height: 10px;
                        background: white;
                        border: 1px solid #dee2e6;
                        border-radius: 50%;
                        display: inline-block;"></span>
                    <span style="
                        width: 10px;
                        height: 10px;
                        background: white;
                        border: 1px solid #dee2e6;
                        border-radius: 50%;
                        display: inline-block;"></span>
                </div> -->
            
                <span style="font-family: Euclid Circular B Medium; font-style: normal; font-size: 1.2rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">
                    √âchelle √† 5 Dimensions pour √âtats Alt√©r√©s de Conscience <br>
                </span>
            </h1>
        </div>

        <div class="content">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="section active" style="margin-bottom: 2rem;">
                <div style="
                    background: #f8f9fa;
                    border: 0.5px solid #ffffff;
            border-radius: 50px 50px 50px 50px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
                    padding: 2rem;
                    color: #2c3e50;
                    font-size: 1rem;
                    text-align: justify;
                    line-height: 1.6;">
                    
                    <p>
                        Ce site propose l‚Äôadministration de l'<strong>√©chelle 5D-ASC</strong> (<em>Five-Dimensional Altered States of Consciousness</em>, Dittrich A., 1985, 2010) ainsi que de ses <strong>11 sous-√©chelles OAV</strong> (ou <em>11D-ASC</em>, Studerus et al., 2010), dans leur <em>version fran√ßaise</em>.
                    </p>
                    <p><br>
                        La traduction, l‚Äôadaptation et la validation psychom√©trique de cette version ont √©t√© r√©alis√©es par E. Kervadec, P. Mathieu, XXX
                    </p>
                    
                    <p><br>
                        <strong>Confidentialit√© :</strong> Aucune donn√©e n‚Äôest collect√©e, transmise ou stock√©e par ce site. Vos r√©ponses ne quittent jamais votre appareil. Un fichier Excel est g√©n√©r√© localement √† la fin du questionnaire.
                    </p>
                    <p><br>
                        <strong>Instructions :</strong> L‚Äôobjectif de ce questionnaire est d‚Äô√©valuer la modification de l‚Äô√©tat de conscience lors de votre exp√©rience ‚Äì par rapport √† votre √©tat de conscience habituel. Pour cela, vous devez √©valuer les diff√©rentes affirmations suivantes sur une √©chelle de 0 √† 100 : 0 repr√©sentant une absence de modification de l‚Äô√©tat de conscience par rapport √† votre √©tat de base (i.e.: <strong>Non</strong>, pas plus que d‚Äôhabitude) et 100 repr√©sentant une modification majeure de l‚Äô√©tat de conscience par rapport √† votre √©tat de base (i.e.: <strong>Oui</strong>, bien plus que d‚Äôhabitude).
                    </p><br>
<p><strong>Veuillez utiliser toutes les graduations interm√©diaires pour d√©crire votre exp√©rience le plus pr√©cis√©ment possible.</strong></p>
                    
                    <p><br>
                        Pour citer le travail d‚Äôadaptation en fran√ßais :<br><br>
                        <strong>Kervadec et al.</strong>, (2025)¬†<em>Psychometric Validation of the French Version of the Five-Dimensional Altered States of Consciousness Questionnaire (5D-ASC) and Associated 11 OAV Subscales.</em>
                        <br><br>
                        <p>
                            Pour citer les travaux originaux concernant le questionnaire : 
                            <br><br>
                            <strong>Dittrich et al.</strong>, (2010) <em>5D-ASC: Questionnaire for the Assessment of Altered States of Consciousness. A Short Introduction.</em> 
                            Zurich, Switzerland: 
                            <a href="https://www.google.com/url?..." target="_blank" rel="noopener noreferrer" style="color: #4b0082;">
                            PSIN PLUS</a>.
                            <br><br>
                            <strong>Studerus et al.</strong>, (2010) <em>Psychometric evaluation of the altered states of consciousness rating scale (OAV).</em> 
                            <a href="https://doi.org/10.1371/journal.pone.0012412" target="_blank" rel="noopener noreferrer" style="color: #4b0082;">
                            PLoS ONE, 5(8): e12412
                            </a>.
                        </p>
                    
                </div>
            </div>
            <!-- Version Selection -->
            <div id="versionSelection" class="section active">
                <div class="version-selector" style="
    background: #f8f9fa;
    border: 0.5px solid #ffffff;
    border-radius: 50px 50px 50px 50px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    padding: 2rem;
    color: #3a4651;
    font-size: 1rem;
    line-height: 1.6;">
                    
                    <h2 class="satoshi-title">Choisissez votre version :</h2>
                    <div class="version-buttons">
                        <button class="version-btn" onclick="selectVersion('5D', 94)">
                            <span>5D-ASC
                            <br><small>Version compl√®te - 94 items</small></span>
                        </button>
                        <button class="version-btn" onclick="selectVersion('11D', 42)">
                            <span>11D-ASC
                            <br><small>Version courte - 42 items</small></span>
                        </button>
                    </div>
                    <div style="text-align: center;">
                        <button class="pdf-btn" onclick="downloadPDF()">
                            <span>üìÑ T√©l√©chargez la version PDF</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Demographic Section -->
            <div id="demographicSection" class="section">
                <h2 style="margin-bottom: 1.5rem;">Informations socio-d√©mographiques :</h2>
                
                <div class="form-group">
                    <label for="age">√Çge <span class="required-indicator">*</span></label>
                    <input type="number" id="age" min="18" max="100" required>
                    <div class="error-message" id="ageError">Veuillez saisir votre √¢ge.</div>
                </div>

                <div class="form-group">
                    <label for="gender">Genre <span class="required-indicator">*</span></label>
                    <select id="gender" required>
                        <option value="">S√©lectionnez...</option>
                        <option value="femme">Femme</option>
                        <option value="homme">Homme</option>
                        <option value="non-binaire">Non-binaire</option>
                        <option value="prefer-not-say">Pr√©f√®re ne pas r√©pondre</option>
                    </select>
                    <div class="error-message" id="genderError">Veuillez s√©lectionner votre genre.</div>
                </div>

                <div class="form-group">
                    <label for="education">Niveau d'√©ducation</label>
                    <select id="education">
                        <option value="">S√©lectionnez...</option>
                        <option value="primaire">√âducation primaire</option>
                        <option value="secondaire">√âducation secondaire</option>
                        <option value="secondaire">BEP/CAP</option>
                        <option value="bac">Baccalaur√©at</option>
                        <option value="bac+2">Bac+2</option>
                        <option value="licence">Licence (Bac+3)</option>
                        <option value="master">Master (Bac+5)</option>
                        <option value="doctorat">Doctorat</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="experience">Avez-vous d√©j√† v√©cu des √©tats modifi√©s de conscience ?</label>
                    <select id="experience">
                        <option value="">S√©lectionnez...</option>
                        <option value="jamais">Jamais</option>
                        <option value="rarement">Rarement</option>
                        <option value="occasionnellement">Occasionnellement</option>
                        <option value="regulierement">R√©guli√®rement</option>
                    </select>
                </div>

                <div class="navigation">
                    <button class="nav-btn secondary" onclick="goToSection('versionSelection')">Retour</button>
                    <button class="nav-btn" onclick="startQuestionnaire()">Commencer le questionnaire</button>
                </div>
            </div>

            <!-- Items Section -->
            <div id="itemsSection" class="section">
                <div style="
    background: #f0f4f8;
    border: 1px solid #c8ddf2;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 2rem;
    font-size: 0.95rem;
    color: #3a4651;
    text-align: justify;">
    <strong>‚ÑπÔ∏è</strong> Pour chaque item, vous devez cliquer sur le curseur pour enregistrer votre r√©ponse, m√™me si vous souhaitez indiquer la valeur 0.  
    Lorsque la valeur affich√©e devient <strong style="color: #90c49c; text-shadow: 1px 1px 2px rgb(255, 255, 255);">verte</strong>, cela signifie que votre r√©ponse est enregistr√©e.
    Il est toujours possible de revenir en arri√®re ou de modifier vos r√©ponses. 
</div>
                <div id="itemsContainer"></div>
                
                <div class="navigation">
                    <button class="nav-btn secondary" onclick="previousItems()">Pr√©c√©dent</button>
                    <span id="itemsProgress">Questions 1-5 sur X</span>
                    <button class="nav-btn" onclick="nextItems()">Suivant</button>
                </div>
            </div>

            <!-- Completion Section -->
            <div id="completionSection" class="section">
                <div class="completion-section">
                    <h2>‚Äì Questionnaire termin√© ‚Äì </h2>
                    <p>Merci pour votre participation. Vous pouvez d√©sormais t√©l√©charger un fichier r√©capitulatif, comprenant une synth√®se de vos r√©ponses ainsi que les scores moyens calcul√©s pour chaque dimension √©valu√©e. </p>
                    <button class="download-btn" onclick="downloadResults()">
                        üìÑ T√©l√©charger les r√©sultats
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration globale
        let currentVersion = '';
        let totalItems = 0;
        let currentItemIndex = 0;
        let itemsPerPage = 5;
        let responses = {};

        // Items du questionnaire 5D-ASC (94 items)
        const items5D = [
            {id: 1, text: "J'ai senti que j'√©tais dans un autre monde merveilleux.", dimension: "OBN"},
            {id: 2, text: "Mes pens√©es et mes actions ont √©t√© ralenties.", dimension: "VIR"},
            {id: 3, text: "Les sensations corporelles ont √©t√© tr√®s agr√©ables.", dimension: "OBN"},
            {id: 4, text: "J'ai entendu des mots isol√©s sans savoir d'o√π ils venaient.", dimension: "AUA"},
            {id: 5, text: "J'ai entendu des sons et des tonalit√©s sans savoir d'o√π ils venaient.", dimension: "AUA"},
            {id: 6, text: "J'ai eu l'impression d'√™tre gagn√© par des forces obscures.", dimension: "AED"},
            {id: 7, text: "J'ai vu des choses que je savais ne pas √™tre r√©elles.", dimension: "VRS"},
            {id: 8, text: "Je me suis senti comme une marionnette.", dimension: "AED"},
            {id: 9, text: "J'ai eu le sentiment d'√™tre connect√© √† un pouvoir sup√©rieur.", dimension: "OBN"},
            {id: 10, text: "Je me suis senti fatigu√©.", dimension: "VIR"},
            {id: 11, text: "Une m√©lodie que je devais constamment r√©p√©ter m'est venue.", dimension: "AUA"},
            {id: 12, text: "J'ai ressenti un plaisir sans limites.", dimension: "OBN"},
            {id: 13, text: "Des bruits insignifiants ont ressembl√© √† de vrais mots ou des phrases.", dimension: "AUA"},
            {id: 14, text: "J'ai vu des motifs r√©guliers dans le noir complet ou les yeux ferm√©s.", dimension: "VRS"},
            {id: 15, text: "Je me suis senti ivre.", dimension: "VIR"},
            {id: 16, text: "J'ai senti que j'√©tais en train d'√™tre transform√© pour toujours d'une mani√®re miraculeuse.", dimension: "OBN"},
            {id: 17, text: "J'ai senti que j'√©tais √† la limite de l'inconscience.", dimension: "VIR"},
            {id: 18, text: "Tout a sembl√© s'unir pour ne faire qu'un.", dimension: "OBN"},
            {id: 19, text: "J'ai entendu mes pens√©es comme si je les avais prononc√©es √† voix haute.", dimension: "AUA"},
            {id: 20, text: "Les bruits ont sembl√© influencer ce que je voyais.", dimension: "VRS"},
            {id: 21, text: "Je me suis senti tourment√©.", dimension: "AED"},
            {id: 22, text: "J'ai vu des couleurs face √† moi dans le noir total ou avec les yeux ferm√©s.", dimension: "VRS"},
            {id: 23, text: "Les formes des choses ont sembl√© changer avec les sons et les bruits.", dimension: "VRS"},
            {id: 24, text: "J'ai per√ßu tout comme flou, comme √† travers une sorte de brouillard.", dimension: "VIR"},
            {id: 25, text: "Une voix a comment√© tout ce que je pensais, bien que personne ne soit l√†.", dimension: "AUA"},
            {id: 26, text: "Il m'a sembl√© ne plus avoir de corps.", dimension: "OBN"},
            {id: 27, text: "J'ai eu des difficult√©s √† prendre m√™me la plus petite d√©cision.", dimension: "AED"},
            {id: 28, text: "Les choses de tous les jours ont eu une signification particuli√®re.", dimension: "VRS"},
            {id: 29, text: "Je me suis senti somnolent.", dimension: "VIR"},
            {id: 30, text: "J'ai entendu des phrases compl√®tes sans savoir d'o√π elles venaient.", dimension: "AUA"},
            {id: 31, text: "Les choses autour de moi ont eu un nouveau sens √©trange pour moi.", dimension: "VRS"},
            {id: 32, text: "J'ai eu peur que l'√©tat dans lequel j'√©tais dure pour toujours.", dimension: "AED"},
            {id: 33, text: "J'ai vu des lumi√®res ou des flashs lumineux dans le noir total ou les yeux ferm√©s.", dimension: "VRS"},
            {id: 34, text: "Il m'a sembl√© que mon environnement et moi ne faisions qu'un.", dimension: "OBN"},
            {id: 35, text: "Les soucis et les angoisses de la vie quotidienne ont sembl√© sans importance.", dimension: "OBN"},
            {id: 36, text: "Ma perception du temps et de l'espace a √©t√© modifi√©e comme si je r√™vais.", dimension: "OBN"},
            {id: 37, text: "Ma perception a √©t√© floue.", dimension: "VIR"},
            {id: 38, text: "J'ai eu des difficult√©s √† distinguer les choses importantes de celles sans importance.", dimension: "AED"},
            {id: 39, text: "J'ai vu des sc√®nes d√©filer dans le noir total ou avec mes yeux ferm√©s.", dimension: "VRS"},
            {id: 40, text: "J'ai ressenti des pouvoirs extraordinaires en moi.", dimension: "OBN"},
            {id: 41, text: "J'ai v√©cu un sentiment d'√©ternit√©.", dimension: "OBN"},
            {id: 42, text: "Les conflits et les contradictions ont sembl√© s'√©vanouir.", dimension: "OBN"},
            {id: 43, text: "J'ai eu peur sans √™tre capable de dire exactement pourquoi.", dimension: "AED"},
            {id: 44, text: "Tout m'est apparu d√©form√© de mani√®re terrifiante.", dimension: "AED"},
            {id: 45, text: "Le monde m'a sembl√© au-del√† du bien et du mal.", dimension: "OBN"},
            {id: 46, text: "J'ai per√ßu mon environnement comme √©trange et bizarre.", dimension: "AED"},
            {id: 47, text: "Je me suis senti comme paralys√©.", dimension: "AED"},
            {id: 48, text: "J'ai entendu de la musique sans savoir d'o√π elle venait.", dimension: "AUA"},
            {id: 49, text: "J'ai entendu quelque chose faiblement que je n'ai pas pu identifier.", dimension: "AUA"},
            {id: 50, text: "J'ai eu des ressentis tr√®s profonds.", dimension: "OBN"},
            {id: 51, text: "Je me suis senti engourdi.", dimension: "VIR"},
            {id: 52, text: "J'ai ressenti le pass√©, le pr√©sent et le futur comme un tout.", dimension: "OBN"},
            {id: 53, text: "J'ai ressenti un vide insupportable.", dimension: "AED"},
            {id: 54, text: "Les objets autour de moi m'√©voquaient bien plus d'√©motions que d'habitude.", dimension: "VRS"},
            {id: 55, text: "A partir d'un bruit initialement diffus et que je ne pouvais pas identifier comme r√©el ont √©volu√© des sons et des tonalit√©s clairs.", dimension: "AUA"},
            {id: 56, text: "Je me suis senti menac√©.", dimension: "AED"},
            {id: 57, text: "Beaucoup de choses me sont apparues d'une beaut√© √† couper le souffle.", dimension: "OBN"},
            {id: 58, text: "Des choses que je pensais oubli√©es depuis longtemps me sont venues √† l'esprit.", dimension: "VRS"},
            {id: 59, text: "J'ai √©t√© comme je me sens habituellement juste avant de m'endormir.", dimension: "VIR"},
            {id: 60, text: "J'ai ressenti mon corps engourdi, sans vie et/ou √©tranger √† moi-m√™me.", dimension: "AED"},
            {id: 61, text: "Je me suis senti comme √† moiti√© endormi.", dimension: "VIR"},
            {id: 62, text: "J'ai eu l'impression d'√™tre en dehors de mon corps.", dimension: "OBN"},
            {id: 63, text: "√áa a √©t√© comme si je flottais.", dimension: "OBN"},
            {id: 64, text: "Je me suis senti isol√© de tout et de tout le monde.", dimension: "AED"},
            {id: 65, text: "J'ai entendu des voix qui ne parvenaient pas de l'environnement comme habituellement.", dimension: "AUA"},
            {id: 66, text: "J'ai entendu quelque chose comme un bourdonnement, un sifflement ou un fredonnement sans en reconna√Ætre la cause.", dimension: "AUA"},
            {id: 67, text: "J'ai √©t√© incapable d'achever une pens√©e, ma pens√©e s'est interrompue √† plusieurs reprises.", dimension: "AED"},
            {id: 68, text: "J'ai senti que j'√©tais sur le point de m'endormir.", dimension: "VIR"},
            {id: 69, text: "J'ai gagn√© en clart√© et fait des connexions entre des sujets et des concepts qui me rendaient perplexe avant.", dimension: "OBN"},
            {id: 70, text: "Beaucoup de choses m'ont sembl√© incroyablement dr√¥les.", dimension: "VRS"},
            {id: 71, text: "Les limites entre mon environnement et moi ont sembl√© s'estomper.", dimension: "OBN"},
            {id: 72, text: "J'ai pu voir des images de mon pass√© ou de mon imagination de mani√®re extr√™mement claire.", dimension: "VRS"},
            {id: 73, text: "Je me suis senti totalement libre et d√©livr√© de toutes obligations.", dimension: "OBN"},
            {id: 74, text: "J'ai entendu des bruits diffus sans savoir d'o√π ils venaient.", dimension: "AUA"},
            {id: 75, text: "La couleur des choses a sembl√© alt√©r√©e par les sons ou les bruits.", dimension: "VRS"},
            {id: 76, text: "Les sons et les bruits ont √©t√© plus faibles que d'habitude.", dimension: "AUA"},
            {id: 77, text: "J'ai eu des pens√©es tr√®s originales.", dimension: "VRS"},
            {id: 78, text: "J'ai eu l'impression de ne plus avoir ma propre volont√©.", dimension: "AED"},
            {id: 79, text: "J'ai eu peur de perdre le contr√¥le de moi-m√™me.", dimension: "AED"},
            {id: 80, text: "Je suis rest√© fig√© dans une position tr√®s peu naturelle pendant une longue p√©riode.", dimension: "AED"},
            {id: 81, text: "J'ai v√©cu une sorte d'√©merveillement.", dimension: "OBN"},
            {id: 82, text: "Mon imagination a √©t√© tr√®s vive.", dimension: "VRS"},
            {id: 83, text: "Les choses dans mon environnement ont sembl√© plus petites ou plus grandes.", dimension: "VRS"},
            {id: 84, text: "Je me suis senti √©puis√©.", dimension: "VIR"},
            {id: 85, text: "Le temps passait lentement et de mani√®re angoissante.", dimension: "AED"},
            {id: 86, text: "J'ai v√©cu une grande paix int√©rieure.", dimension: "OBN"},
            {id: 87, text: "Tout autour de moi a sembl√© anim√© de vie.", dimension: "OBN"},
            {id: 88, text: "Tout se passait si vite que je n'ai pas pu tout suivre.", dimension: "AED"},
            {id: 89, text: "J'ai eu l'impression que quelque chose de terrible allait arriver.", dimension: "AED"},
            {id: 90, text: "J'ai pu me souvenir de certains √©v√®nements de mani√®re tr√®s claire.", dimension: "VRS"},
            {id: 91, text: "J'ai v√©cu l'amour universel.", dimension: "OBN"},
            {id: 92, text: "Il y a eu des sons autour de moi qui, √† mon avis, n'√©taient probablement pas r√©els.", dimension: "AUA"},
            {id: 93, text: "J'ai entendu un tic-tac, un coup, une sonnerie ou un cliquetis sans pouvoir identifier la cause.", dimension: "AUA"},
            {id: 94, text: "Mon exp√©rience a eu des aspects religieux.", dimension: "OBN"}
        ];

        // Items pour la version 11D-ASC (42 items s√©lectionn√©s)
        const items11D = [
            // Anxi√©t√©
            {id: 32, text: "J'ai eu peur que l'√©tat dans lequel j'√©tais dure pour toujours.", subscale: "Anxi√©t√©"},
            {id: 44, text: "Tout m'est apparu d√©form√© de mani√®re terrifiante.", subscale: "Anxi√©t√©"},
            {id: 46, text: "J'ai per√ßu mon environnement comme √©trange et bizarre.", subscale: "Anxi√©t√©"},
            {id: 89, text: "J'ai eu l'impression que quelque chose de terrible allait arriver.", subscale: "Anxi√©t√©"},
            {id: 43, text: "J'ai eu peur sans √™tre capable de dire exactement pourquoi.", subscale: "Anxi√©t√©"},
            {id: 56, text: "Je me suis senti menac√©.", subscale: "Anxi√©t√©"},
            
            // Perte du contr√¥le et de la cognition
            {id: 27, text: "J'ai eu des difficult√©s √† prendre m√™me la plus petite d√©cision.", subscale: "Perte du contr√¥le"},
            {id: 38, text: "J'ai eu des difficult√©s √† distinguer les choses importantes de celles sans importance.", subscale: "Perte du contr√¥le"},
            {id: 47, text: "Je me suis senti comme paralys√©.", subscale: "Perte du contr√¥le"},
            {id: 67, text: "J'ai √©t√© incapable d'achever une pens√©e, ma pens√©e s'est interrompue √† plusieurs reprises.", subscale: "Perte du contr√¥le"},
            {id: 64, text: "Je me suis senti isol√© de tout et de tout le monde.", subscale: "Perte du contr√¥le"},
            {id: 8, text: "Je me suis senti comme une marionnette.", subscale: "Perte du contr√¥le"},
            {id: 78, text: "J'ai eu l'impression de ne plus avoir ma propre volont√©.", subscale: "Perte du contr√¥le"},
            
            // Sortie de corps
            {id: 63, text: "√áa a √©t√© comme si je flottais.", subscale: "Sortie de corps"},
            {id: 26, text: "Il m'a sembl√© ne plus avoir de corps.", subscale: "Sortie de corps"},
            {id: 62, text: "J'ai eu l'impression d'√™tre en dehors de mon corps.", subscale: "Sortie de corps"},
            
            // Synesth√©sie audiovisuelle
            {id: 20, text: "Les bruits ont sembl√© influencer ce que je voyais.", subscale: "Synesth√©sie audiovisuelle"},
            {id: 23, text: "Les formes des choses ont sembl√© changer avec les sons et les bruits.", subscale: "Synesth√©sie audiovisuelle"},
            {id: 75, text: "La couleur des choses a sembl√© alt√©r√©e par les sons ou les bruits.", subscale: "Synesth√©sie audiovisuelle"},
            
            // Alt√©ration √©l√©ment visuel
            {id: 33, text: "J'ai vu des lumi√®res ou des flashs lumineux dans le noir total ou les yeux ferm√©s.", subscale: "Alt√©ration visuelle"},
            {id: 14, text: "J'ai vu des motifs r√©guliers dans le noir complet ou les yeux ferm√©s.", subscale: "Alt√©ration visuelle"},
            {id: 22, text: "J'ai vu des couleurs face √† moi dans le noir total ou avec les yeux ferm√©s.", subscale: "Alt√©ration visuelle"},
            
            // Vivacit√©
            {id: 82, text: "Mon imagination a √©t√© tr√®s vive.", subscale: "Vivacit√©"},
            {id: 39, text: "J'ai vu des sc√®nes d√©filer dans le noir total ou avec mes yeux ferm√©s.", subscale: "Vivacit√©"},
            {id: 72, text: "J'ai pu voir des images de mon pass√© ou de mon imagination de mani√®re extr√™mement claire.", subscale: "Vivacit√©"},
            
            // Sentiment d'unit√©
            {id: 18, text: "Tout a sembl√© s'unir pour ne faire qu'un.", subscale: "Sentiment d'unit√©"},
            {id: 34, text: "Il m'a sembl√© que mon environnement et moi ne faisions qu'un.", subscale: "Sentiment d'unit√©"},
            {id: 41, text: "J'ai v√©cu un sentiment d'√©ternit√©.", subscale: "Sentiment d'unit√©"},
            {id: 42, text: "Les conflits et les contradictions ont sembl√© s'√©vanouir.", subscale: "Sentiment d'unit√©"},
            {id: 52, text: "J'ai ressenti le pass√©, le pr√©sent et le futur comme un tout.", subscale: "Sentiment d'unit√©"},
            
            // Exp√©rience spirituelle
            {id: 9, text: "J'ai eu le sentiment d'√™tre connect√© √† un pouvoir sup√©rieur.", subscale: "Exp√©rience spirituelle"},
            {id: 81, text: "J'ai v√©cu une sorte d'√©merveillement.", subscale: "Exp√©rience spirituelle"},
            {id: 94, text: "Mon exp√©rience a eu des aspects religieux.", subscale: "Exp√©rience spirituelle"},
            
            // Perspicacit√©
            {id: 50, text: "J'ai eu des ressentis tr√®s profonds.", subscale: "Perspicacit√©"},
            {id: 69, text: "J'ai gagn√© en clart√© et fait des connexions entre des sujets et des concepts qui me rendaient perplexe avant.", subscale: "Perspicacit√©"},
            {id: 77, text: "J'ai eu des pens√©es tr√®s originales.", subscale: "Perspicacit√©"},
            
            // Pl√©nitude
            {id: 86, text: "J'ai v√©cu une grande paix int√©rieure.", subscale: "Pl√©nitude"},
            {id: 91, text: "J'ai v√©cu l'amour universel.", subscale: "Pl√©nitude"},
            {id: 12, text: "J'ai ressenti un plaisir sans limites.", subscale: "Pl√©nitude"},
            
            // Changement des perceptions
            {id: 54, text: "Les objets autour de moi m'√©voquaient bien plus d'√©motions que d'habitude.", subscale: "Changement des perceptions"},
            {id: 28, text: "Les choses de tous les jours ont eu une signification particuli√®re.", subscale: "Changement des perceptions"},
            {id: 31, text: "Les choses autour de moi ont eu un nouveau sens √©trange pour moi.", subscale: "Changement des perceptions"}
        ];

        function selectVersion(version, itemCount) {
            currentVersion = version;
            totalItems = itemCount;
            
            // Mise √† jour visuelle des boutons
            document.querySelectorAll('.version-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Attendre un peu pour l'effet visuel
            setTimeout(() => {
                goToSection('demographicSection');
            }, 300);
        }

        function goToSection(sectionId) {
            // Cacher toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Afficher la section demand√©e
            document.getElementById(sectionId).classList.add('active');
            
            // Mise √† jour de la barre de progression
            updateProgressBar();
        }

        function updateProgressBar() {
            const sections = ['versionSelection', 'demographicSection', 'itemsSection', 'completionSection'];
            const currentSectionIndex = sections.findIndex(section => 
                document.getElementById(section).classList.contains('active')
            );
            
            let progress = 0;
            if (currentSectionIndex === 1) progress = 25; // D√©mographique
            else if (currentSectionIndex === 2) {
                // Items section - calculer bas√© sur les items compl√©t√©s
                const completedItems = Object.keys(responses).filter(key => key.startsWith('item_')).length;
                progress = 25 + (completedItems / totalItems * 65); // 65% pour les items
            }
            else if (currentSectionIndex === 3) progress = 100; // Termin√©
            
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function validateDemographics() {
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            
            let isValid = true;
            
            // Validation √¢ge
            if (!age || age < 18 || age > 100) {
                document.getElementById('ageError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('ageError').style.display = 'none';
            }
            
            // Validation genre
            if (!gender) {
                document.getElementById('genderError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('genderError').style.display = 'none';
            }
            
            return isValid;
        }

        function downloadPDF() {
    // Ouvrir le fichier PDF dans un nouvel onglet
    window.open('VersionPapier.pdf', '_blank');
}

        function startQuestionnaire() {
            if (!validateDemographics()) {
                return;
            }
            
            // Sauvegarder les donn√©es d√©mographiques
            responses.age = document.getElementById('age').value;
            responses.gender = document.getElementById('gender').value;
            responses.education = document.getElementById('education').value;
            responses.experience = document.getElementById('experience').value;
            responses.version = currentVersion;
            responses.totalItems = totalItems;
            
            // Initialiser les items
            currentItemIndex = 0;
            displayItems();
            goToSection('itemsSection');
        }

        function displayItems() {
            const container = document.getElementById('itemsContainer');
            const items = currentVersion === '5D' ? items5D : items11D;
            
            // Calculer les items √† afficher
            const startIndex = currentItemIndex;
            const endIndex = Math.min(startIndex + itemsPerPage, items.length);
            const currentItems = items.slice(startIndex, endIndex);
            
            // G√©n√©rer le HTML
            let html = '';
            currentItems.forEach((item, index) => {
                const actualIndex = startIndex + index;
                const subscaleInfo = item.subscale ? `<small style="color: #6c757d; font-style: italic;">Dimension: ${item.subscale}</small><br><br>` : 
                                    item.dimension ? `<small style="color: #6c757d; font-style: italic;">Dimension: ${item.dimension}</small><br><br>` : '';
                
                                    html += `
    <div class="item-container">
        <div class="item-question">
            <!-- <strong>Question ${actualIndex + 1}/${items.length}</strong><br> -->
            <!-- ${subscaleInfo} -->
            ${item.text}
        </div>

        <div class="vas-container">
            <!-- Barre VAS -->
            <input type="range" 
        class="vas-slider" 
        id="item_${item.id}" 
        min="0" 
        max="100" 
        value="${responses['item_' + item.id] || 0}"
        oninput="updateVasValue(${item.id}, this.value)"
        onclick="updateVasValue(${item.id}, this.value)">
            
            <!-- L√©gendes et valeur sur la m√™me ligne -->
            <div class="vas-row">
                <span class="vas-label left"><strong>Non</strong>, pas plus que d'habitude<br><small>(0)</small></span>
                <div class="vas-value ${responses['item_' + item.id] !== undefined ? 'saved' : ''}" id="value_${item.id}">
    ${responses['item_' + item.id] || 0}
</div>
                <span class="vas-label right"><strong>Oui</strong>, bien plus que d'habitude<br><small>(100)</small></span>
            </div>
        </div>
    </div>
`;
            });
            
            container.innerHTML = html;

            // Initialiser les jauges pour les valeurs d√©j√† sauvegard√©es
currentItems.forEach(item => {
    const savedValue = responses['item_' + item.id];
    if (savedValue !== undefined) {
        const sliderElement = document.getElementById(`item_${item.id}`);
        const progress = (savedValue / 100) * 100;
        sliderElement.style.setProperty('--slider-progress', `${progress}%`);
    }
});
            
            // Mise √† jour du compteur de progression
            const progress = document.getElementById('itemsProgress');
            progress.textContent = `${startIndex + 1}-${endIndex} sur ${items.length}`;
            
            // Mise √† jour des boutons de navigation
            const prevBtn = document.querySelector('.navigation .nav-btn.secondary');
            const nextBtn = document.querySelector('.navigation .nav-btn:not(.secondary)');
            
            prevBtn.disabled = startIndex === 0;
            
            if (endIndex >= items.length) {
                nextBtn.textContent = 'Terminer';
                nextBtn.onclick = finishQuestionnaire;
            } else {
                nextBtn.textContent = 'Suivant';
                nextBtn.onclick = nextItems;
            }
            
            updateProgressBar();
        }

        function updateVasValue(id, value) {
    const valueElement = document.getElementById(`value_${id}`);
    const sliderElement = document.getElementById(`item_${id}`);
    
    valueElement.textContent = value;
    valueElement.classList.add('active');
    valueElement.classList.add('saved');
    
    // Mettre √† jour la jauge
    const progress = (value / 100) * 100;
    sliderElement.style.setProperty('--slider-progress', `${progress}%`);
    
    // Sauvegarder la r√©ponse (m√™me si c'est 0)
    responses['item_' + id] = parseInt(value);
    
    // Forcer une mise √† jour visuelle
    setTimeout(() => {
        valueElement.classList.remove('active');
        valueElement.classList.add('saved');
    }, 200);
}

        function previousItems() {
            if (currentItemIndex > 0) {
                currentItemIndex = Math.max(0, currentItemIndex - itemsPerPage);
                displayItems();
            } else {
                goToSection('demographicSection');
            }
        }

        function nextItems() {
            const items = currentVersion === '5D' ? items5D : items11D;
            currentItemIndex = Math.min(currentItemIndex + itemsPerPage, items.length);
            
            if (currentItemIndex >= items.length) {
                finishQuestionnaire();
            } else {
                displayItems();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function finishQuestionnaire() {
            const items = currentVersion === '5D' ? items5D : items11D;
            
            // V√©rifier que toutes les questions ont une r√©ponse ET que les sliders ont √©t√© touch√©s
            const missingResponses = items.filter(item => {
    return responses['item_' + item.id] === undefined;
});

if (missingResponses.length > 0) {
    alert(`Il manque ${missingResponses.length} r√©ponse(s). Veuillez ajuster tous les curseurs pour enregistrer vos r√©ponses (la valeur doit devenir verte).`);
    return;
}
            responses.completionTime = new Date().toISOString();
            goToSection('completionSection');
        }
        function downloadResults() {
    try {
        const items = currentVersion === '5D' ? items5D : items11D;

        // Calculer les moyennes par dimension/subscale
        const dimensionScores = {};
        let totalScore = 0;
        let itemCount = 0;

        items.forEach(item => {
            const score = responses['item_' + item.id];
            const dimension = currentVersion === '11D' ? item.subscale : item.dimension;

            if (!dimensionScores[dimension]) {
                dimensionScores[dimension] = { total: 0, count: 0 };
            }

            dimensionScores[dimension].total += score;
            dimensionScores[dimension].count += 1;
            totalScore += score;
            itemCount += 1;
        });

        // Calculer les moyennes
        const dimensionAverages = {};
        for (const dimension in dimensionScores) {
            dimensionAverages[dimension] = (dimensionScores[dimension].total / dimensionScores[dimension].count).toFixed(2);
        }
        const overallAverage = (totalScore / itemCount).toFixed(2);

        // G√©n√©rer l'ID et la date
        const participantId = 'P_' + Date.now();
        const dateCompletion = new Date().toLocaleString('fr-FR');

        // Cr√©er le workbook
        const workbook = XLSX.utils.book_new();

        // FEUILLE 1 : Donn√©es d√©taill√©es (format long)
        const detailedData = items.map((item, index) => ({
            'ID Participant': participantId,
            'Version': currentVersion + '-ASC',
            'Num√©ro Item': item.id,
            'Texte Item': item.text,
            'Dimension': currentVersion === '11D' ? item.subscale : item.dimension,
            'Valeur': responses['item_' + item.id] ?? ''
        }));

        const worksheet1 = XLSX.utils.json_to_sheet(detailedData);
        worksheet1['!cols'] = [
            { wch: 18 }, // ID Participant
            { wch: 12 }, // Version
            { wch: 12 }, // Num√©ro Item
            { wch: 60 }, // Texte Item
            { wch: 25 }, // Dimension
            { wch: 10 }  // Valeur
        ];
        XLSX.utils.book_append_sheet(workbook, worksheet1, 'Donnees_Detaillees');

        // FEUILLE 2 : Moyennes par dimension
        const summaryData = [];
        summaryData.push(['Participant_ID', 'Version', 'Dimension_Subscale', 'Moyenne', 'Nombre_Items']);
        for (const dimension in dimensionAverages) {
            summaryData.push([
                participantId,
                currentVersion + '-ASC',
                dimension,
                parseFloat(dimensionAverages[dimension]),
                dimensionScores[dimension].count
            ]);
        }
        summaryData.push([
            participantId,
            currentVersion + '-ASC',
            'TOTAL',
            parseFloat(overallAverage),
            itemCount
        ]);

        const worksheet2 = XLSX.utils.aoa_to_sheet(summaryData);
        worksheet2['!cols'] = [
            { wch: 15 },
            { wch: 12 },
            { wch: 25 },
            { wch: 12 },
            { wch: 15 }
        ];
        XLSX.utils.book_append_sheet(workbook, worksheet2, 'Moyennes_Dimensions');

        // FEUILLE 3 : R√©sum√© participant
        const participantSummary = [];
        participantSummary.push(['Informations Participant']);
        participantSummary.push(['']);
        participantSummary.push(['ID Participant', participantId]);
        participantSummary.push(['Version', currentVersion + '-ASC']);
        participantSummary.push(['√Çge', responses.age]);
        participantSummary.push(['Genre', responses.gender]);
        participantSummary.push(['√âducation', responses.education || 'Non renseign√©']);
        participantSummary.push(['Exp√©rience EMC', responses.experience || 'Non renseign√©']);
        participantSummary.push(['Date de passation', dateCompletion]);
        participantSummary.push(['']);
        participantSummary.push(['R√©sultats']);
        participantSummary.push(['']);
        participantSummary.push(['Dimension/Sous-√©chelle', 'Moyenne', 'Items']);
        const sortedDimensions = Object.keys(dimensionAverages).sort();
        sortedDimensions.forEach(dimension => {
            participantSummary.push([
                dimension,
                parseFloat(dimensionAverages[dimension]),
                dimensionScores[dimension].count
            ]);
        });
        participantSummary.push(['']);
        participantSummary.push(['MOYENNE TOTALE', parseFloat(overallAverage), itemCount]);

        const worksheet3 = XLSX.utils.aoa_to_sheet(participantSummary);
        worksheet3['!cols'] = [
            { wch: 25 },
            { wch: 15 },
            { wch: 10 }
        ];
        XLSX.utils.book_append_sheet(workbook, worksheet3, 'Resume_Participant');

        // T√©l√©charger le fichier
        const fileName = `Resultats_${currentVersion}-ASC_${participantId}_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(workbook, fileName);

        // Message de confirmation
        setTimeout(() => {
            let summaryText = `üì® Fichier t√©l√©charg√© avec succ√®s !\n\n`;
            summaryText += `üìë R√©sum√© de vos r√©sultats :\n`;
            summaryText += `‚Ä¢ Moyenne g√©n√©rale : ${overallAverage}/100\n`;
            summaryText += `‚Ä¢ Version : ${currentVersion}-ASC (${itemCount} items)\n\n`;
            summaryText += `Le fichier Excel contient 3 onglets :\n`;
            summaryText += `‚Ä¢ Donn√©es d√©taill√©es\n`;
            summaryText += `‚Ä¢ Moyennes par dimension\n`;
            summaryText += `‚Ä¢ R√©sum√© participant\n\n`;
            summaryText += `Merci de votre participation !`;

            alert(summaryText);
        }, 500);

    } catch (error) {
        console.error('Erreur lors du t√©l√©chargement:', error);
        alert('‚ùå Erreur lors du t√©l√©chargement. Veuillez r√©essayer.');
    }
}

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateProgressBar();
        });
    </script>
<footer style="
font-size: 0.8rem;
font-style: italic;
color: #6c757d;
text-align: center;
padding: 1rem 2rem;
margin-top: 3rem;">
¬© 2025 ‚Äî Ewen KERVADEC 
<br>
D√©velopp√© pour un usage acad√©mique et scientifique.   
<br>
H√©bergement statique, sans collecte ni traitement automatis√© de donn√©es personnelles.
</footer>    
</body>
</html>
